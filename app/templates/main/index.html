{% import 'macros/nav_macros.html' as nav %}
{% import 'macros/location_macros.html' as loc %}
{% import 'macros/form_macros.html' as f %}

<!DOCTYPE html>
<html>
    <head>
        {% include 'partials/_head.html' %}
        {# Any templates that extend this template can set custom_head_tags to add scripts to their page #}
        {% block custom_head_tags %}{% endblock %}
    </head>
    <body>
      <form method=post>
        <div class="ui inverted vertical masthead center aligned segment" style="background-color: #345073">
            <div class="ui container">
                {% block nav %}
                  {# add dropdown variable here to the render_nav method to render dropdowns #}
                  {{ nav.render_nav(current_user) }}
                {% endblock %}

                {% include 'partials/_flashes.html' %}
                {# When extended, the content block contains all the html of the webpage #}
                {% block content %}
                {% endblock %}

                {# Implement CSRF protection for site #}
                {% if csrf_token()|safe %}
                    <div style="visibility: hidden; display: none">
                      <input type="hidden" name="csrf_token" value="{{ csrf_token()|safe }}">
                    </div>
                {% endif %}
            </div>
            <div class="ui text container" style="padding: 100px 0 100px 0;">
                <h1 class="ui huge inverted header">
                    Whistleblower Database
                    <div class="sub header">Curated by Government Accountability Project</div>
                </h1>
                <p>
                    Government Accountability Project is the international leader in whistleblower protection. <br/>
                    This database is a curated, searchable list of scholarly materials related to whistleblowing. <br/>
                </p>
                <br>
                <div class="ui action input fluid large">
                  {{ form.query(class='ui input large fluid') }}
                  <button class="ui button large" type="submit">Search</button>
                </div>
            </div>
        </div>
        <div class="ui container" style="padding: 100px 0 100px 0;">
          <div class="ui menu">
            <div class="ui pointing dropdown link item">Resource Type
              <i class="dropdown icon"></i>
              <div class="ui menu">
                <div class="header">Categories</div>
                <div class="ui form grouped fields header">
                  {{ f.render_form_field(form.book) }}
                  {{ f.render_form_field(form.news_article) }}
                  {{ f.render_form_field(form.journal_article) }}
                  {{ f.render_form_field(form.law) }}
                  {{ f.render_form_field(form.video) }}
                  {{ f.render_form_field(form.report) }}
                  {{ f.render_form_field(form.other) }}
                </div>
                <div class="item" style="pointer-events: none; padding:0px!important;"></div>
              </div>
            </div>

            <div class="ui pointing dropdown link item">Publication Date
              <i class="dropdown icon"></i>
              <div class="ui menu">
                <div class="ui header small">Date Published</div>
                  <div class="ui center aligned calendar" style="width: 150px;">
                    {{ form.start_date.label }}
                    <div class="ui input left icon fluid" id="start_date">
                      <i class="calendar icon"></i>
                      {{ form.start_date(class="ui calendar")}}
                    </div>
                  </div>
                  <br>
                  <div class="ui calendar" style="width: 150px;">
                    {{ form.end_date.label }}
                    <div class="ui input left icon fluid" id="end_date">
                      <i class="calendar icon"></i>
                      {{ form.end_date(class="ui calendar")}}
                    </div>
                  </div>
                  <div class="item" style="pointer-events: none; padding:0px!important;"></div>
                </div>
            </div>
            <div class="ui multiple dropdown">
              <i class="tags icon"></i>
              <span class="text">Add Tags</span>
              <i class="dropdown icon"></i>
              <div class="menu">
                <div class="ui icon search input">
                  <i class="search icon"></i>
                  <input type="text" placeholder="Search tags...">
                </div>
                <div class="divider"></div>
                <div class="header">
                  <i class="tags icon"></i>
                  Tag Label
                </div>
                {{ f.render_form_field_tags(form.tags) }}
              </div>
            </div>
          </div>
          <div class="ui grid">
           <div class="row">
            <div class="sixteen wide column">
                <table class="ui searchable sortable unstackable selectable celled table" style="overflow-x: scroll;">
                    <thead>
                        <tr>
                            <th class="three wide">Title</th>
                            <th class="two wide">Attribution</th>
                            <th class="two wide">Resource Type</th>
                            <th>Description</th>
                            <th class="three wide">tags</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for c in search_results[:100] %}
                        <tr>
                            <td>{{ c.title }}</td>
                            <td>{% if c.author_last_name or c.author_first_name %}
                                  {{ c.author_first_name + ' ' + c.author_last_name}}
                                {% elif c.name %}
                                  {{ c.name }}
                                {% elif c.govt_body %}
                                  {{ c.govt_body }}
                                {% endif %}
                            </td>
                            <td>
                              {{ c.doc_type.split('_')|join(' ') }}
                            </td>
                            <td>
                              {{ c.description.split(' ')[:19]|join(' ') + '...'}}
                            </td>
                            <td>
                              {% for tag in c.tags %}
                              <div class="ui basic label" style="margin: 2px">
                                {{ tag.tag.tag }}
                              </div>
                              {% endfor %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <div class="ui buttons" style="width: 100%; align-items: center; justify-content: center;">
                  <a class="ui button left labeled icon button" type='button' href="#">
                    <i class="left chevron icon"></i>
                    Back
                  </a>
                  <a class="ui basic button"  type='button'>
                    Page 1
                  </a>
                  <a class="ui button right labeled icon button" type='button' href="#">
                    Next
                    <i class="right chevron icon"></i>
                  </a>
                </div>
                </div>
              </div>
            </div>
          </div>
      </form>
        <script>
          $( document ).ready(function() {
              $( '#state' ).attr( "disabled", "disabled")
              $('#start_date').calendar({
              type: 'date',
              endCalendar: $('#end_date')
              });
              $('#end_date').calendar({
              type: 'date',
              startCalendar: $('#start_date')
              });
              $('#country').change(function (){
                if ($('#country').val() == 'US') {

                }
                else {
                }
              });
          });
          $(document).ready(function() {
            $('.ui.dropdown').dropdown();
            $('select.dropdown').dropdown();
          });
        </script>
    </body>
</html>
